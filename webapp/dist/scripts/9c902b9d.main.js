"use strict";var map,railStations=new L.featureGroup,slowDrivingMarkers=new L.featureGroup;$(document).ready(function(){function a(){$("#expList").find("li:has(ul)").click(function(a){return this==a.target&&($(this).toggleClass("expanded"),$(this).children("ul").toggle("medium")),e=a.target.firstChild.nodeValue,b(a.target.firstChild.nodeValue),!1}).addClass("collapsed").children("ul").hide(),$("#expandList").unbind("click").click(function(){$(".collapsed").addClass("expanded"),$(".collapsed").children().show("medium")}),$("#collapseList").unbind("click").click(function(){$(".collapsed").removeClass("expanded"),$(".collapsed").children().hide("medium")})}function b(a){railStations.clearLayers(),slowDrivingMarkers.clearLayers();var b=[];$.getJSON(c+"/rail/view/"+a).done(function(a){L.geoJson(a,{pointToLayer:function(a,e){var g=a.properties.tags.name;b.push(e);var h=L.divIcon({className:"iconbox",iconSize:new L.Point(50,50),html:'<div class="dashboard" id="'+g+'"></div>'});return"Crossings"===d?$.getJSON(c+"/rail/numberOfCrossings/"+f[0]+"/"+f[2]+"/"+g).done(function(a){$("#"+g).html("Crossings: "+a.numberOfCrossings)}):"Density"===d&&$.getJSON(c+"/rail/trafficDensity/"+g+"/"+g+"/"+f[0]+"/"+f[2]).done(function(a){$("#"+g).html("Density: "+a[0].count)}),L.marker(e,{icon:h}).bindPopup(g)}}).addTo(railStations)}),"Speed restriction"===d&&$.getJSON(c+"/rail/slowDriving/").done(function(a){L.geoJson(a,{pointToLayer:function(a,c){var d='<img src="images/'+a.properties.tags.name+'.png" alt="'+a.properties.tags.name+'"width="600" height="600">';return console.log(d),b.push(c),L.marker(c).bindPopup(d,{maxWidth:1400,maxHeight:800})}}).addTo(slowDrivingMarkers)})}var c="http://localhost:8080",d="Speed restriction",e="Norge",f=[];f.length=4,L.Icon.Default.imagePath="/images/";{var g="http://{s}.tile.cloudmade.com/733e599a1fe841afaceb855b0ac0f833/{styleId}/256/{z}/{x}/{y}.png",h="Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade",i=L.tileLayer("http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.opencyclemap.org">OpenCycleMap</a>, &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});L.tileLayer(g,{styleId:33738,attribution:h}),L.tileLayer(g,{styleId:12790,attribution:h})}map=L.map("map",{center:new L.LatLng(64.4367,16.39882),zoom:5,layers:[i,railStations,slowDrivingMarkers],worldCopyJump:!0});var j="",k=L.control();k.onAdd=function(){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},k.update=function(){this._div.innerHTML=j},$.getJSON(c+"/rail/section").done(function(b){for(var c='<div id="listContainer"><ul><li>Norge<ul id="expList">',d=0;d<b.length;d++){c+="<li>"+b[d].omrade+"<ul>";for(var e=0;e<b[d].baner.length;e++){c+="<li>"+b[d].baner[e].banesjef+"<ul>";for(var f=0;f<b[d].baner[e].banestrekninger.length;f++)c+="<li>"+b[d].baner[e].banestrekninger[f].banestrekning+"</li>";c+="</ul></li>"}c+="</ul></li>"}c+="</ul></li></ul></div>",k._div.innerHTML=c,a()}).fail(function(){console.dir(arguments)}),k.addTo(map),$("#theLink").click(function(a){a.preventDefault(),showAlert()}),b(e);L.Control.timeControl=L.Control.extend({options:{position:"bottomright"},onAdd:function(a){this._map=a;var b=L.DomUtil.create("div","info"),c=L.DomUtil.create("div","info",b);return this._fromDate=this._createDateInput("fromDate",c),this._fromTime=this._createTimeInput("fromTime",c),this._toDate=this._createDateInput("toDate",c),this._toTime=this._createTimeInput("toTime",c),this._changeButton=this._createChangeTimeButton("changeTimeButton",c,this._changeTimeVariables,this),this._container=b,this._changeTimeVariables(),this._container},_createDateInput:function(a,b){var c=L.DomUtil.create("a",a,b),d=new Date("2012-02-01"),e=d.getFullYear(),f=d.getMonth()+1;"fromDate"===a&&(f>1?f--:f=12),10>f&&(f="0"+f);var g=d.getDate();10>g&&(g="0"+g);var h='<input type="text" id ="'+a+'" name="'+a+'" value="'+e+"-"+f+"-"+g+'">';return c.innerHTML=h,c},_createTimeInput:function(a,b){var c=L.DomUtil.create("a",a,b),d=new Date,e=d.getHours(),f=d.getMinutes();10>e&&(e="0"+e),10>f&&(f="0"+f);var g='<input type="text" name="'+a+'" value="'+e+":"+f+'" size="2">';return c.innerHTML=g,c},_createChangeTimeButton:function(a,b,c,d){var e=L.DomUtil.create("a",a,b);e.innerHTML="Change",e.href="#",e.title="Change time interval";var f=L.DomEvent.stopPropagation;L.DomEvent.on(e,"click",f).on(e,"mousedown",f).on(e,"dblclick",f).on(e,"click",L.DomEvent.preventDefault).on(e,"click",c,d)},_changeTimeVariables:function(){var a=[];a.length=4;var b=/^(19|20)\d\d[- /.]((0[1-9]|[0-9])|1[012])[- /.]((0[1-9]|[1-9])|[12][0-9]|3[01])$/,c=/^([\d]|[0-5][\d])[: /.]([\d]|[0-5][\d])$/,d=this._fromDate.children.fromDate.value,e=this._toDate.children.toDate.value,g=this._fromTime.children.fromTime.value,h=this._toTime.children.toTime.value;b.test(d)&&b.test(e)&&c.test(g)&&c.test(h)?(a[0]=d,a[1]=g,a[2]=e,a[3]=h,f=a):console.log("Invalid time input")}}),L.Control.top5Lists=L.Control.extend({options:{position:"bottomleft"},onAdd:function(a){this._map=a;var b=L.DomUtil.create("div","info");return this._list=this._generateList("topList",b),this._container=b,this._container},_generateList:function(a,b){var c=L.DomUtil.create("a",a,b),d="Top 5 stations with crossings:<br>1: OSL 8 400<br>2: LYS 3 400<br>3: LLS 451<br>4: OTT 300<br>5: REN 162";return c.innerHTML=d,c}}),L.Control.changeStatisticalInformation=L.Control.extend({options:{position:"topleft"},onAdd:function(a){this._map=a;var b=L.DomUtil.create("div","info");return this._statInfo=this._createChangeInformation("changeStatisticalInformation",b,this._changeInformation,this),this._container=b,this._container},_createChangeInformation:function(a,b){var c=L.DomUtil.create("a",a,b),d='Select views:<ul id="infoChangeList"><li>Crossings<li>Speed restriction<li>Density</ul>';return c.innerHTML=d,c}});(new L.Control.timeControl).addTo(map),(new L.Control.top5Lists).addTo(map),(new L.Control.changeStatisticalInformation).addTo(map);$("#infoChangeList").on("click","li",function(a){d=a.currentTarget.firstChild.nodeValue,b(e)})});